<% # VARIABLES
dossier_total = @rental.dossiers.count
dossier_to_validate = dossier_total - @rental.dossiers.where(status: 'not_selected').count
%>

<div class="container">
	<h1 class="header d-flex justify-content-between align-items-baseline">
		<div class="breadcrumb">
			<%= link_to(raw("<i class=\"fas fa-tachometer-alt\"></i>"), dashboard_path ) %>
			<%= link_to("My flat ##{@flat.id}", flat_path(@flat.id)) %>
			Rental #<%= @rental.id %>
		</div>
		<div class="rent">
			<i class="fas fa-hand-holding-usd"></i> <%= @rental.initial_rent %>€ <small class="text-muted">/ month</small>
		</div>
	</h1>
	<p class="lead">Rental is <strong><%= @rental.pending ? "pending" : "closed" %></strong></p>

	<div class="row">
		<div class="col col-12">
			<div class="card-dashboard">
			<%# THERE IS AT LEAST 1 DOSSIER %>
			<% if @rental.pending %>
				<% is_are = dossier_to_validate > 1 ? 'are' : 'is' %>
				<h2><%= pluralize(dossier_to_validate, 'applicant') %> on <%= dossier_total %> <%= is_are %> currently waiting for validation</h2>
				
				<%# DISPLAY DOSSIERS %>
				<% if dossier_total > 0 %>
				<div>
					<% ["visiting", "ok_for_visit", "to_improve", "not_selected"].each do  |status|%>
						<div>
							<h3 class="d-flex justify-content-between align-items-center pt-3">
								<%= raw(badge("#{@rental.dossiers.where(status: status).count} #{status}", 'primary', 'users', '', false)) %>
								<% if status == 'ok_for_visit' && @rental.dossiers.where(status: status).count > 0 %>
								<div>
									<%= link_to "Organize visit", organize_visit_flat_rental_path(@flat, @rental), class: 'btn btn-primary'  %>
								</div>
								<% end %>
							</h3>
							<ul class="list-group">
								<% @rental.dossiers.each do |dossier| %>
									<% if dossier.status == status%>
										<li class="list-group-item d-flex justify-content-between align-items-center">
											<!-- DESCRIPTION -->
											<div>
												<% candidate = User.find(dossier.candidate_id) %>
												<%#= raw(ap candidate) %>
												<h4><%= "#{candidate.first_name.capitalize}" %> <%= "#{candidate.last_name.upcase}" %></h4>
												<%= "dossier ##{dossier.id} - #{dossier.monthly_revenues} €/m - [all docs?]" %>
											</div>
											<!-- BUTTONS -->
											<div>
												<% if dossier.status == "ok_for_visit" %>
													<%#= "[BOUTON Don't select]" %>
													<i class="fas fa-arrows-alt"></i>
												<% end %>
												<% if dossier.status == "to_improve" || dossier.status == "not_selected"%>
													<%#= "[BOUTON Ok for visits]" %>
													<i class="fas fa-arrows-alt"></i>
												<% end %>
											</div>
										</li>
									<% end %>
								<% end %>
							</ul>
						</div>
					<% end %>
				</div>
			</div>

			<% end %>
		<%# THERE'S NO DOSSIER %>
		<% else %>
			<div>
				<%= @rental.tenant.id "is your current tenant"%>
			</div>
		<% end %>
		</div>
	</div>
</div>
